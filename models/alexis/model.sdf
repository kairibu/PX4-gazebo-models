<?xml version="1.0" ?>
<sdf version="1.10">
    <model name='alexis' canonical_link='base_link'>
        <pose>0 0 0 0 -0.5 0</pose>
        <link name='base_link'>
            <pose relative_to='__model__'>0.5 0 0.4 0 0 0</pose>
            <collision name='fuselage_collision'>
                <pose relative_to='__model__'>0 0 0 0 0 0</pose>
                <geometry>
                <box>
                    <size>1.7 1 0.3</size>
                </box>
                </geometry>
                <surface>
                    <contact>
                        <ode>
                        <max_vel>10</max_vel>
                        <min_depth>0.01</min_depth>
                        </ode>
                    </contact>
                </surface>
            </collision>
            <collision name='wings_collision'>
                <pose>0.6 -0.5 0.07 0 0 0</pose>
                <geometry>
                <box>
                    <size>0.5 2.0 0.2</size>
                </box>
                </geometry>
                <surface>
                <contact>
                    <ode>
                    <max_vel>10</max_vel>
                    <min_depth>0.01</min_depth>
                    </ode>
                </contact>
                </surface>
            </collision>
            <inertial> <!--inertial properties of the link mass, inertia matix-->
                <mass>1.14395</mass>
                <inertia>
                <ixx>0.095329</ixx>
                <ixy>0</ixy>
                <ixz>0</ixz>
                <iyy>0.381317</iyy>
                <iyz>0</iyz>
                <izz>0.476646</izz>
                </inertia>
            </inertial>
            <visual name='visual'>
                <geometry>
                    <mesh>
                        <scale>1 1 1</scale>
                        <uri>./meshes/alexis.dae</uri>
                    </mesh>
                </geometry>
                <!--let's add color to our link-->
                <material>
                <ambient>0 0 1.0 1</ambient>
                <diffuse>0.1 0.1 0.8 1</diffuse>
                <specular>0.1 0.1 0.6 1</specular>
                </material>
            </visual>
            <sensor name="magnetometer_sensor" type="magnetometer">
                <always_on>1</always_on>
                <update_rate>100</update_rate>
                <magnetometer>
                <!-- TODO: update to fix units and coordinate system when we move past Harmonic -->
                <!-- See https://github.com/gazebosim/gz-sim/pull/2460 -->
                <!-- 3mgauss RMS: NOTE: noise is in tesla but sensor reports data in gauss -->
                <!-- Noise modeled after IIS2MDC -->
                <x>
                    <noise type="gaussian">
                    <stddev>0.0001</stddev>
                    </noise>
                </x>
                <y>
                    <noise type="gaussian">
                    <stddev>0.0001</stddev>
                    </noise>
                </y>
                <z>
                    <noise type="gaussian">
                    <stddev>0.0001</stddev>
                    </noise>
                </z>
                </magnetometer>
            </sensor>
            <sensor name="imu_sensor" type="imu">
                <always_on>1</always_on>
                <update_rate>250</update_rate>
                <imu>
                <angular_velocity>
                    <x>
                    <noise type="gaussian">
                        <mean>0</mean>
                        <stddev>0.0003394</stddev>
                        <dynamic_bias_stddev>3.8785e-05</dynamic_bias_stddev>
                        <dynamic_bias_correlation_time>1000</dynamic_bias_correlation_time>
                    </noise>
                    </x>
                    <y>
                    <noise type="gaussian">
                        <mean>0</mean>
                        <stddev>0.0003394</stddev>
                        <dynamic_bias_stddev>3.8785e-05</dynamic_bias_stddev>
                        <dynamic_bias_correlation_time>1000</dynamic_bias_correlation_time>
                    </noise>
                    </y>
                    <z>
                    <noise type="gaussian">
                        <mean>0</mean>
                        <stddev>0.0003394</stddev>
                        <dynamic_bias_stddev>3.8785e-05</dynamic_bias_stddev>
                        <dynamic_bias_correlation_time>1000</dynamic_bias_correlation_time>
                    </noise>
                    </z>
                </angular_velocity>
                <linear_acceleration>
                    <x>
                    <noise type="gaussian">
                        <mean>0</mean>
                        <stddev>0.004</stddev>
                        <dynamic_bias_stddev>0.006</dynamic_bias_stddev>
                        <dynamic_bias_correlation_time>300</dynamic_bias_correlation_time>
                    </noise>
                    </x>
                    <y>
                    <noise type="gaussian">
                        <mean>0</mean>
                        <stddev>0.004</stddev>
                        <dynamic_bias_stddev>0.006</dynamic_bias_stddev>
                        <dynamic_bias_correlation_time>300</dynamic_bias_correlation_time>
                    </noise>
                    </y>
                    <z>
                    <noise type="gaussian">
                        <mean>0</mean>
                        <stddev>0.004</stddev>
                        <dynamic_bias_stddev>0.006</dynamic_bias_stddev>
                        <dynamic_bias_correlation_time>300</dynamic_bias_correlation_time>
                    </noise>
                    </z>
                </linear_acceleration>
                </imu>
            </sensor>
            <sensor name="navsat_sensor" type="navsat">
                <always_on>1</always_on>
                <update_rate>30</update_rate>
            </sensor>
            <sensor name="air_pressure_sensor" type="air_pressure">
                <always_on>1</always_on>
                <update_rate>50</update_rate>
                <air_pressure>
                <pressure>
                    <noise type="gaussian">
                    <mean>0</mean>
                    <stddev>0.01</stddev>
                    </noise>
                </pressure>
                </air_pressure>
            </sensor>
        </link>
        <link name="left_aileron">
            <inertial>
                <mass>0.00000001</mass>
                <inertia>
                <ixx>0.000001</ixx>
                <ixy>0.0</ixy>
                <iyy>0.000001</iyy>
                <ixz>0.0</ixz>
                <iyz>0.0</iyz>
                <izz>0.000001</izz>
                </inertia>
                <pose>0 -0.3 0 0.00 0 0.0</pose>
            </inertial>
            <visual name='left_aileron_visual'>
                <pose>1.1 -0.6 0.52 0 0 0</pose>
                <geometry>
                    <box>
                        <size>0.06 0.5 0.02</size>
                    </box>
                </geometry>
                <material>
                    <ambient>1 0 0 1.0</ambient>
                    <diffuse>1 0 0 1.0</diffuse>
                </material>
            </visual>
        </link>
        <joint name='servo_0' type='revolute'>
            <parent>base_link</parent>
            <child>left_aileron</child>
            <pose>1.05 -0.6 0.52 0 0 0</pose>
            <axis>
                <xyz>0 1 0</xyz>
                <dynamics>
                    <damping>1.000</damping>
                </dynamics>
            </axis>
            <physics>
                <ode>
                <implicit_spring_damper>1</implicit_spring_damper>
                </ode>
            </physics>
        </joint>

        <link name="right_aileron">
            <inertial>
                <mass>0.00000001</mass>
                <inertia>
                <ixx>0.000001</ixx>
                <ixy>0.0</ixy>
                <iyy>0.000001</iyy>
                <ixz>0.0</ixz>
                <iyz>0.0</iyz>
                <izz>0.000001</izz>
                </inertia>
                <pose>0 0.3 0 0.00 0 0.0</pose>
            </inertial>
            <visual name='right_aileron_visual'>
                <pose>1.1 0.6 0.52 0 0 0</pose>
                <geometry>
                    <box>
                        <size>0.06 0.5 0.02</size>
                    </box>
                </geometry>
                <material>
                    <ambient>1 0 0 1.0</ambient>
                    <diffuse>1 0 0 1.0</diffuse>
                </material>
            </visual>
        </link>
        <joint name='servo_1' type='revolute'>
            <parent>base_link</parent>
            <child>right_aileron</child>
            <pose>1.05 0.6 0.52 0 0 0</pose>
            <axis>
                <xyz>0 1 0</xyz>
                <dynamics>
                    <damping>1.000</damping>
                </dynamics>
            </axis>
            <physics>
                <ode>
                <implicit_spring_damper>1</implicit_spring_damper>
                </ode>
            </physics>
        </joint>


        <link name="left_rudder">
            <inertial>
                <mass>0.00000001</mass>
                <inertia>
                <ixx>0.000001</ixx>
                <ixy>0.0</ixy>
                <iyy>0.000001</iyy>
                <ixz>0.0</ixz>
                <iyz>0.0</iyz>
                <izz>0.000001</izz>
                </inertia>
                <pose>0 0.3 0 0.00 0 0.0</pose>
            </inertial>
            <visual name='left_rudder_visual'>
                <pose relative_to="base_link">1.6 0.15 0.2 -0.55 0 0.0</pose>
                <geometry>
                    <box>
                        <size>0.06 0.22 0.02</size>
                    </box>
                </geometry>
                <material>
                    <ambient>1 0 0 1.0</ambient>
                    <diffuse>1 0 0 1.0</diffuse>
                </material>
            </visual>
        </link>
        <link name="right_rudder">
            <inertial>
                <mass>0.00000001</mass>
                <inertia>
                <ixx>0.000001</ixx>
                <ixy>0.0</ixy>
                <iyy>0.000001</iyy>
                <ixz>0.0</ixz>
                <iyz>0.0</iyz>
                <izz>0.000001</izz>
                </inertia>
                <pose>0 0.3 0 0.00 0 0.0</pose>
            </inertial>
            <visual name='right_rudder_visual'>
                <pose relative_to="base_link">1.6 -0.15 0.2 0.55 0 0.0</pose>
                <geometry>
                    <box>
                        <size>0.06 0.22 0.02</size>
                    </box>
                </geometry>
                <material>
                    <ambient>1 0 0 1.0</ambient>
                    <diffuse>1 0 0 1.0</diffuse>
                </material>
            </visual>
        </link>

        <link name='rotor_puller'>
            <inertial>
                <pose>0 0 0 0 0 0</pose>
                <mass>0.005</mass>
                <inertia>
                <ixx>9.75e-07</ixx>
                <ixy>0</ixy>
                <ixz>0</ixz>
                <iyy>0.000166704</iyy>
                <iyz>0</iyz>
                <izz>0.000167604</izz>
                </inertia>
            </inertial>
            <collision name='rotor_puller_collision'>
                <pose>1.2 0 0.45 0 1.57079633 0</pose>
                <geometry>
                <box>
                    <size>0.1 0.3 0.3</size>
                </box>
                </geometry>
                <surface>
                    <contact>
                        <ode/>
                    </contact>
                    <friction>
                        <ode/>
                    </friction>
                </surface>
            </collision>
            <!-- <visual name='rotor_puller_visual'>
                <pose>1.2 0 0.45 0 1.57079633 0</pose>
                <geometry>
                    <box>
                        <size>0.3 0.3 0.1</size>
                    </box>
                </geometry>
                <material>
                    <ambient>1 0 0 1.0</ambient>
                    <diffuse>1 0 0 1.0</diffuse>
                </material>
            </visual> -->
            <visual name='rotor_puller_visual'>
                <pose>1.15 0 0.45 0 1.57079633 0</pose>
                <geometry>
                <mesh>
                    <scale>1.4 1.4 1.4</scale>
                    <uri>./meshes/iris_prop_ccw.dae</uri>
                </mesh>
                </geometry>
                <material>
                    <ambient>1 0 0 1.0</ambient>
                    <diffuse>1 0 0 1.0</diffuse>
                </material>
            </visual>
                <gravity>0</gravity>
                <velocity_decay/>
                <self_collide>0</self_collide>
        </link>

        <joint name='rotor_puller_joint' type='revolute'>
            <parent>base_link</parent>
            <child>rotor_puller</child>
            <pose>1.15 0 0.45 0 1.57079633 0</pose>
            <axis>
                <xyz>0 0 1</xyz>
                <limit>
                <lower>-1e+16</lower>
                <upper>1e+16</upper>
                </limit>
                <dynamics>
                <spring_reference>0</spring_reference>
                <spring_stiffness>0</spring_stiffness>
                </dynamics>
            </axis>
        </joint>




        <plugin filename="gz-sim-lift-drag-system" name="gz::sim::systems::LiftDrag">
            <a0>0.05984281113</a0>
            <cla>4.752798721</cla>
            <cda>1.5</cda>
            <cma>0.0</cma>
            <alpha_stall>0.3391428111</alpha_stall>
            <cla_stall>-3.85</cla_stall>
            <cda_stall>-0.9233984055</cda_stall>
            <cma_stall>0</cma_stall>
            <cp>-0.05 0.45 0.05</cp>
            <area>0.6</area>
            <air_density>1.2041</air_density>
            <forward>1 0 0</forward>
            <upward>0 0 1</upward>
            <link_name>base_link</link_name>
            <control_joint_name>servo_0</control_joint_name>
            <control_joint_rad_to_cl>-0.3</control_joint_rad_to_cl>
        </plugin>

        <plugin filename="gz-sim-joint-controller-system" name="gz::sim::systems::JointController">
        <joint_name>servo_0</joint_name>
        <initial_velocity>1</initial_velocity>
        <topic>test_topic_0</topic>
        </plugin>
        <plugin filename="gz-sim-joint-controller-system" name="gz::sim::systems::JointController">
        <joint_name>servo_1</joint_name>
        <initial_velocity>1</initial_velocity>
        <topic>test_topic_1</topic>
        </plugin>



        <plugin filename="gz-sim-lift-drag-system" name="gz::sim::systems::LiftDrag">
            <a0>0.05984281113</a0>
            <cla>4.752798721</cla>
            <cda>1.5</cda>
            <cma>0.0</cma>
            <alpha_stall>0.3391428111</alpha_stall>
            <cla_stall>-3.85</cla_stall>
            <cda_stall>-0.9233984055</cda_stall>
            <cma_stall>0</cma_stall>
            <cp>-0.05 -0.45 0.05</cp>
            <area>0.6</area>
            <air_density>1.2041</air_density>
            <forward>1 0 0</forward>
            <upward>0 0 1</upward>
            <link_name>base_link</link_name>
            <control_joint_name>servo_1</control_joint_name>
            <control_joint_rad_to_cl>-0.3</control_joint_rad_to_cl>
        </plugin>
        <plugin filename="gz-sim-multicopter-motor-model-system" name="gz::sim::systems::MulticopterMotorModel">
            <jointName>rotor_puller_joint</jointName>
            <linkName>rotor_puller</linkName>
            <turningDirection>cw</turningDirection>
            <timeConstantUp>0.0125</timeConstantUp>
            <timeConstantDown>0.025</timeConstantDown>
            <maxRotVelocity>1000</maxRotVelocity>
            <motorConstant>1.2e-05</motorConstant>
            <momentConstant>0.016</momentConstant>
            <commandSubTopic>command/motor_speed</commandSubTopic>
            <motorNumber>0</motorNumber>
            <rotorDragCoefficient>8.06428e-05</rotorDragCoefficient>
            <rollingMomentCoefficient>1e-06</rollingMomentCoefficient>
            <rotorVelocitySlowdownSim>10</rotorVelocitySlowdownSim>
            <motorType>velocity</motorType>
        </plugin>
    </model>
</sdf>
